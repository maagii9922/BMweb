<main>{% include "tabs.html" %}
    <div class="container-fluid px-4"> 
        <h5 class="mt-4">Бараа шинээр бүртгүүлэх хүсэлтийн жагсаалт</h5>        
        <ol class="breadcrumb mb-4">
        </ol>  
        {% if user.role_id == 1 %}      
        <a href="{% url 'product' %}" class="btn btn-primary" role="button">Бараа шинээр бүртгүүлэх</a>
        {% endif %}
        <div class="card mb-4">
            <!-- <div class="card-header">
                <i class="fas fa-table me-1"></i>
                Жагсаалт
            </div> -->
            <div class="card-body">
                {% include "tableTop.html" %}
                    <table id="datatablesSimple" class="dataTable-table">
                        <thead>
                            <tr>
                                <th data-sortable="" class="asc">
                                    <a href="#" class="dataTable-sorter">№</a>
                                </th>
                                <th data-sortable="" class="asc">
                                    <a href="#" class="dataTable-sorter">Нэр</a>
                                </th>
                                <th data-sortable="" class="asc">
                                    <a href="#" class="dataTable-sorter">Төрөл</a>
                                </th>
                                <th data-sortable="" class="asc">
                                    <a href="#" class="dataTable-sorter">Ер.нэршил</a>
                                </th>
                                <th data-sortable="" class="asc">
                                    <a href="#" class="dataTable-sorter">Эм.хэлбэр</a>
                                </th>
                                <th data-sortable="" class="asc">
                                    <a href="#" class="dataTable-sorter">Нийлүүлэгч</a>
                                </th>
                                <th data-sortable="" class="asc">
                                    <a href="#" class="dataTable-sorter">Барааны ангилал</a>
                                </th>
                                <!-- <th data-sortable="" class="asc">
                                    <a href="#" class="dataTable-sorter">Борлуулж болох эсэх</a>
                                </th>
                                <th data-sortable="" class="asc">
                                    <a href="#" class="dataTable-sorter">Худалдаж болох эсэх</a>
                                </th> -->
                                <!-- <th data-sortable="" class="asc">
                                    <a href="#" class="dataTable-sorter">Зарлагдаж болох эсэх</a>
                                </th> -->
                                <!-- <th data-sortable="" class="asc">
                                    <a href="#" class="dataTable-sorter">Посоор зарж болох эсэх</a>
                                </th> -->
                                <!-- <th data-sortable="" class="asc">
                                    <a href="#" class="dataTable-sorter">Посын ангилал</a>
                                </th> -->
                                <th data-sortable="" class="asc">
                                    <a href="#" class="dataTable-sorter">Зураг:</a>
                                </th>
                                <th data-sortable="" class="asc">
                                    <a href="#" class="dataTable-sorter">Төлөв</a>
                                </th>
                                <th data-sortable="" class="asc">
                                    <a href="#" class="dataTable-sorter">Тайлбар:</a>
                                </th>
                                <th data-sortable="" class="asc">
                                    <a href="#" class="dataTable-sorter">Үйлдлүүд</a>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- {{start_index}} -->
                        {% for h in productList %}
                            <tr>
                                <td>{{ forloop.counter0|add:start_index }}</td>
                                <td>{{ h.prodName }}</td>
                                <!-- <td>{{ h.zCode }}</td> -->
                                <td>{{ h.prodType }}</td>
                                <!-- <td>{{ h.zzCode }}</td> -->
                                <!-- <td>{{ h.price }}</td> -->
                                <!-- <td>{{ h.hemNegj }}</td> -->
                                <!-- <td>{{ h.hudNegj }}</td> -->
                                <!-- <td>{{ h.company }}</td> -->
                                <td>{{ h.erNershil }}</td>
                                <td>{{ h.emHelber }}</td>
                                <!-- <td>{{ h.paiz }}</td> -->
                                <!-- <td>{{ h.uildwerlegch }}</td> -->
                                <td>{{ h.uNiiluulegch }}</td>
                                <td>{{ h.category }}</td>
                                <!-- <td>{{ h.borBoloh }}</td> -->
                                <!-- <td>{{ h.hudAwch }}</td> -->
                                <!-- <td>{{ h.zarBoloh }}</td> -->
                                <!-- <td>{{ h.pos }}</td> -->
                                <!-- <td>{{ h.posCat }}</td> -->
                                <td>{{ h.thumbimage }}</td>
                                <td>{{ h.state }}</td>
                                <td>{{ h.description|default_if_none:"" }}</td>
                                <td>
                                    <!-- {{user.role_id}}::{{h.state_id}} -->
                                {% if user.role_id|add:0 < 3 and h.state_id|add:0 < 3 %}    
                                    <a href="/product?edit={{h.id}}"><i class="fas fa-edit"></i></a></form>
                                    <a href="/product?del={{h.id}}" class="confirm-delete" onclick="return confirm('Та устгахдаа итгэлтэй байна уу?')"><i class="fas fa-trash-alt"></i></a></form>
                                {% endif  %}
                                  {% if user.role_id|add:0 >= 3 and h.state_id|add:0 == 1 %}  
                                  <!-- <a href="/change-stateProd/{{h.id}}/1"><i class="fas fa-paper-plane"></i></a> -->
                                  <a href="/change-stateProd/{{h.id}}/3"><i class="fas fa-check-square"></i></a>
                                  <!-- <a href="/change-stateProd/{{h.id}}/2"><i class="fas fa-window-close"></i></a> -->
                            <a id='cancel' href="#cancel" onclick="cancelDialog({{h.id}})"><i class="fas fa-window-close"></i></a> 
                                  {% endif %}

                                </td>
                            </tr>            
                    {% endfor %}    
                </tbody>
                    </table>
                <!-- <div>
                    {% if user.role_id == 1 %}
                        <a href="{% url 'product' %}">prod burtguuleh</a>
                        <input class="btn btn-lg btn-secondary btn-block" type="submit"  value='Нэвтрэх'></input>
                    {% elif user.role_id == 2 %}
                        <a href="{% url 'reg-user' %}">cus burtguuleh</a>
                    {% endif %}
                </div> -->
                
            </div>
            {% include "tableBottom.html" %}
        </div>
    </div>
</main>
<script>
    $(document).on('click', '.confirm-delete', function(){
        return confirm('Та устгахдаа итгэлтэй байна уу?');
    })
      
    window.addEventListener("load", function(){
        let size = "{{size}}"
        if (size){
            sizeCombo = document.getElementById('sizeCombo');
            sizeCombo.value = size
        }
    });
    function rowCount(t){console.log('rowCount', t.value)
        let size = t.value
        window.location.href = '?size='+t.value
        // let p_json = JSON.parse("{{p_json|escapejs}}")
        // let p_json = JSON.parse("{{p_list|escapejs}}")
        // console.log('p_json',p_json)

        // var new_tbody = document.createElement('tbody');
        
        // for (var i = 0; i<p_json.length; i++) { 
        //     let r = p_json[0].fields
        //     var tr = document.createElement('tr'); 
        //     new_tbody.appendChild(tr); 

        //     var tdElement = document.createElement('td');
        //     tdElement.innerHTML = r['prodName'];
        //     tr.appendChild(tdElement);

        //     var tdElement = document.createElement('td');
        //     tdElement.innerHTML = r['prodType'];
        //     tr.appendChild(tdElement);

        // }        
        // let old_tbody = document.getElementById('datatablesSimple').getElementsByTagName('tbody')[0]
        // old_tbody.parentNode.replaceChild(new_tbody, old_tbody)

        
        function cancelDialog(id){console.log('hehah', id)
        var myModal = new bootstrap.Modal(document.getElementById('exampleModal'), {keyboard: false})        
        myModal.show()
        title = document.getElementById('exampleModalLabel')
        title.textContent = 'Тайлбараа оруулна уу'
        desc = document.getElementById('description')
        desc.name = id
    }
    function saveDialog(){
        desc = document.getElementById('description')
        window.location.href = "/change-stateProd/" + desc.name + "/2/" + desc.value;
    }
        

        

     
    }
</script>

<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Цуцлах тайлбар</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <textarea type="text" class="form-control" id="description" name="description"  value="{{data.description}}"}></textarea>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Хаах</button>
          <button type="button" class="btn btn-primary" onclick='saveDialog({{h.id}})'>Хадгалах</button>
        </div>
      </div>
    </div>
  </div>